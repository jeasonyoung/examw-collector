<#--菜单设置列表-->
<#include "ftl/comm.ftl"/>
<#assign module="update_catalog"/>
<#assign dg="${module}_list_dg"/>
<script type="text/javascript">
<!--
$(function(){
	var dg1 = $("#${dg}_remote").treegrid({
		fit:true,
		fitColumns:true,
		rownumbers:true,
		idField:"id",
		treeField:"name",
		singleSelect:false,
		animate:true,
		border:true,
		striped:true,
		columns:[[{
			field:"children",
			checkbox:true
		},{
			title:"类别名称",
			field:"name",
			width:25
		},{
			title:"类别代码",
			field:"id",
			width:15
		},{
			title:"状态",
			field:"status",
			width:35
		}]],
		onLoadError:function(e){
			<@error_dialog "e"/>
		},
		toolbar:[
		{
			iconCls:"icon-add",
			text:"检测课程类别数据更新",
			handler:function(){
				$.messager.confirm("确认","您是否确认检测课程类别数据更新?",function(r){
					if(!r)return;
					dg1.treegrid({url:"<@s.url '/admin/update/catalog/datagrid'/>"});
				});
			}
		}]
	});
	//dg
	var editingId,currentCode;
	var dg = $("#${dg}_local").treegrid({
		url:"<@s.url '/admin/local/catalog/datagrid'/>",
		fit:true,
		fitColumns:true,
		rownumbers:true,
		idField:"id",
		treeField:"cname",
		singleSelect:true,
		animate:true,
		border:true,
		striped:true,
		columns:[[{
			field:"id",
			checkbox:true
		},{
			title:"类别名称",
			field:"cname",
			width:25
		},{
			title:"网校代码",
			field:"schoolId",
			width:15
		},{
			title:"环球CODE",
			field:"code",
			width:15,
			editor:'text'
		}]],
		onLoadError:function(e){
			<@error_dialog "e"/>
		},
		onDblClickRow:function(row)
		{
			if(row.schoolId != "1")
			{
				return;
			}
			if (editingId != undefined){
				dg.treegrid('select', editingId);
				return;
			}
			var row = dg.treegrid('getSelected');
			if (row){
				editingId = row.id;
				currentCode = row.code;
				dg.treegrid('beginEdit', editingId);
			}
		},
		onClickRow:function(row){
			if (editingId != undefined){
				dg.treegrid('endEdit', editingId);
				var row = dg.treegrid('find',editingId);
				console.info(currentCode + "----" + row.code);
				if((currentCode == undefined && row.code=="")||(currentCode != undefined && currentCode == row.code)){
					dg.treegrid('endEdit',editingId);
					editingId = undefined;
					currentCode = undefined;
					return;
				}
				$.ajax({
					url:"<@s.url '/admin/local/catalog/update'/>",
					type:"POST",
					data:{"id":editingId,"code":row.code},
					dataType:"json",
					success:function(data){
						if(data.success){
							editingId = undefined;
							dg.treegrid('reloadFooter');
						}
					}
					
				});
			}
		}
	});
});
//-->
</script>
<div class="easyui-layout" data-options="fit:true" id="${dg}_layout">
	 <div data-options="region:'west',title:'分类更新',split:true,tools: [{
		 	iconCls:'icon-reload',
		 	handler:function(){
			 		$('#${dg}_remote').treegrid('reload');
		 	}
	 	}]" style="padding:5px;width:400px;">
	 	<table id="${dg}_remote"></table>
	 </div>
	 <div data-options="region:'center',title:'本地考试分类'">
		<table id="${dg}_local"></table>
	</div>
</div>
